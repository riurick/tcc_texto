\chapter{Estudo de Caso: Noosfero}
\label{noosfero}
%------------------------------------------------------------------------------%
Durante o quarto capítulo deste trabalho de conclusão de curso, discutiremos sobre 
o ambiente de trabalho e a plataforma de desenvolvimento, chamada Noosfero, assim 
como os testes e as funcionalidades desenvolvidas dentro do processo de colaboração 
com esta plataforma.
%
Noosfero é uma plataforma desenvolvida pela Colivre (Cooperativa de Tecnologias
Livre), possui licença AGPL e é utilizado, principalmente em universidades públicas,
para desenvolvimento de redes colaborativas.
%
O Noosfero foi desenvolvido na linguagem de programação Ruby, versão 1.8.7, e utiliza
o framework Model-View-Controller (MVC) para aplicações web Ruby on Rails, versão 
2.3.5. A escolha destas tecnologias, por parte dos criadores do Noosfero foi baseada 
fato de que o Ruby possui sintaxe simples, elegante e de fácil leitura, o que aumenta
a manutenibilidade do sistema, uma característica importante num projeto de software
livre que visa atrair desenvolvedores externos~\cite{meirelles2013}.

%------------------------------------------------------------------------------%
\section{Desenvolvimento no processo de colaboração ao Noosfero}
Por tratar de um software livre, a plataforma Noosfero possui uma grande quantidade 
de colaboradores, formado por equipes de desenvolvimento como na Universidade de 
Brasília, ou por desenvolvedores independentes. Assim, para que haja sucesso na 
colaboração, são feitas exigências durante o desenvolvimento, assim como testes 
bem definidos para aprovar novas funcionalidade.
%
De acordo com os contribuidores do noosfero, a plataforma livre possui as seguintes 
caracteristicas:
%
\begin{enumerate}
\item Rede Social (três entidades: pessoas, comunidades e organizações); 
\item  CMS: pastas, artigos, RSS, upload e publicação de imagens e arquivos; 
\item  Blog com sistema de notificação de comentários; 
\item  Galeria de imagens; 
\item  e-Portfolios (individuais e de grupos); 
\item  Compartilhar Interesses; 
\item  Fóruns / Discussão Temática; 
\item  Agenda de eventos compartilhadas; 
\item  Vitrine Digital para exposição de produtos e serviços e carrinho de compras; 
\item  Acompanhamento de atividades de usuários e grupos; 
\item  Mensagens assíncronas e Web Chat. 
\end{enumerate}
%
Além da utilização da linguagem de programação Ruby, o desenvolvimento da plataforma 
Noosfero também se baseia em JavaScript, CSS, dentre outras linguagens, como pode-se 
ver na figura abaixo:
%
\begin{figure}[!h]
    \centering
    \includegraphics[keepaspectratio=true,scale=0.60]
      {figuras/noosfero.eps}
    \caption{Desenvolvimento Noosfero - extraída do noosfero.org}
    \label{noosfero}
\end{figure}

%------------------------------------------------------------------------------%
\subsection{Ciclo de desenvolvimento do Noosfero}
%
O desenvolvimento para a plataforma Noosfero é realizado em ciclos e, pela Colivre, 
possui as seguintes fases: desenvolvimento, release 1, release 2 e release final.
%
\subsubsection{Fase de Desenvolvimento}
%
Antes da fase de desenvolvimento for iniciada é necessário que seja feita a 
documentação do que será desenvolvido. Os desenvolvedores responsáveis criam um 
Action Item (Item de ação), contendo a historia de usuário ou os requisitos do novo 
recurso. Um action item pode ser descrito como uma feature (novo recurso) ou como 
um bug (defeito) encontrado, como demonstrado nas figuras abaixo:
%
\begin{figure}[!h]
    \centering
    \includegraphics[keepaspectratio=true,scale=0.65]
      {figuras/noosfero_feature.eps}
    \caption{Descrição de feature - Noosfero}
    \label{noosfero_feature}
\end{figure}
%
\begin{figure}[!h]
    \centering
    \includegraphics[keepaspectratio=true,scale=0.65]
      {figuras/noosfero_bug.eps}
    \caption{Descrição de bug - Noosfero}
    \label{noosfero_bug}
\end{figure}

%------------------------------------------------------------------------------%

Além da documentação, é necessário o envio de um email a comunidade descrevendo o 
que será desenvolvido. A partir deste email, a comunidade irá avaliar a funcionalidade 
descrita e decidir se é um funcionalidade importante para se incorporar ou não. 
Este processo de avaliação tem a duração de uma semana, geralmente.
%
Com a aprovação da comunidade são feitas as revisões do ciclo de desenvolvimento, 
que deve seguir os seguintes passos:
%
\begin{enumerate}
\item Criar um ‘merge request’ juntamente com o código;
\item Código é revisado pela comunidade;
\item Código é bom? 
\subitem Se sim:
\subsubitem Vá para o passo 4;
\subitem Se não:
\subsubitem ‘Merge request’ é rejeitado e as razões por tal são comentadas e 
respondidas.
\subsubitem Desenvolvedores revisam o que está errado reabre atualiza o merge 
request;
\item Código é incluido no código principal.
\end{enumerate}
%------------------------------------------------------------------------------%
\subsubsection{Fase de Release 1}
%
A entrega da release consiste na instalacao da nova versao do codigo no repositorio 
de testes, assim como no código principal quando não houver mais defeitos, ou todos 
os defeitos encontrados forem tratados devidamente. Porém se algum erro crítico for 
encontrado e não for tratado a tempo da release final, o lançamento pode ser adiado 
para a próxima release.
%
\subsubsection{Fase de Release 2}
%
A release 2 não é obrigatória, so ocorre se houver muitas mudanças na release 1 e 
requerer novos testes. Vale lembrar que os procedimentos realizados para aprovar a 
release 2 são os mesmos da release 1
%
\subsubsection{Release Final}
%
A versão final do código é lançada após todos os testes serem aprovados nas releases 
1 e 2, assim o código pode ser atualizado para o código principal do Noosfero, 
encerrando o ciclo de desenvolvimento.

%------------------------------------------------------------------------------%

\section{Testes no processo de colaboração ao Noosfero}
%
Os responsáveis por manter o Noosfero, pessoas que aprovam as solicitações de 
alteração na plataforma, exigem que os plugins passem por uma bateria de testes 
para que esses plugins tenham capacidade de ser incorporados à uma versão do 
Noosfero, prevenindo assim uma possível  inserção de código defeituoso que possa 
afetar o núcleo da plataforma até outros  plugins, além de manter a qualidade de 
código no padrão desejado.
%
Alguns testes automatizados são realizados no noosfero para validação de novos 
recursos de software, dentre eles estão: testes funcionais, testes de aceitação e 
testes unitários, testes estes que são executados na própria plataforma do noosfero.
%
\subsection{Testes de aceitação - Cucumber}
Os testes de aceitação, que possuem uma visão mais voltada para o usuário, fazem 
parte de uma fase do processo de teste em que um teste de caixa-preta é realizado 
num sistema antes de sua disponibilização. Para isso utilizamos o Cucumber, uma 
ferramenta que pode executar documentação de funcionalidades escrita em texto puro. 
Com base nesta especificações, o Cucumber executa testes.
%
O cucumber proporciona uma melhor comunicação entre equipe de desenvolvimento e 
cliente, por utilizar uma linguagem  em texto puro.
%
No cucumber, uma feature (novo recurso de software) é um requisito de alto nível 
expressado da pespectiva de uma pessoa e possui uma estrutura similar as historias 
de usuario do XP~\cite{chelimsky2010}. Essa estrutura é proposta da seguinte forma:
\begin{enumerate}
\item \textbf{Titulo:} Palavra-chave ‘feature’ e um titulo curto que representa o 
objetivo da feature.
\item \textbf{Narrativa:} um texto curto que demonstre os cenários de execução, 
exatamente como a narrativa de uma história de usuário:
%FIGURA%
%Feature: 
%In order to
%As a
%I want
%
\item \textbf{Cenarios:} são a parte concreta de como queremos que o software se 
comporte~\cite{chelimsky2010}, e sendo a parte essencial do teste realizado no 
cucumber. Após a palavra-chave ‘scenario’ define-se o nome do cenário em questão:
%FIGURA%
%Scenario: 
%
\item \textbf{Passos:} Cada cenario possui uma serie de passos que demontram o seu 
comportamento, que são linhas simples iniciadas com as seguintes palavras-chaves: 
Given, When, Then, And, But.
\item \textbf{Given:} Indica uma condição inicial para que o cenario seja executado, 
trata-se das pré-condições do cenário.
\item \textbf{When:}Indica o evento do cenário
\item \textbf{Then:} Indica o que é esperado após o evento ocorrer.
%FIGURA%
%Scenario: 
%Given 
%And
%When
%Then
%And
\end{enumerate}
%------------------------------------------------------------------------------%
\subsection{Testes Funcionais}
%
Os testes funcionais são escritos da seguinte forma:
%
Setup: indica as condições inciais dos testes, setando variáveis de ambiente e de 
configuração por exemplo.
%FIGURA%
%def setup
%    @controller: AccountController.new
%@response: AccountController::Testresponse.new
%    @environment = Environment.default
%end

Titulo: titulo do teste iniciado com a palavra ‘should’ e finalizado com ‘do’
%FIGURA%
%should ‘not authenticate user’ do
%
Passos: código que define o comportamento do teste
%FIGURA%
%post :login, :user => {:login =>’someuser’, :password => ‘somepass’}
%
Verificação: Assertiva que verifica se a ação foi realizada como esperada.
%FIGURA%
%assert nil session [:user]


%------------------------------------------------------------------------------%
\section{Funcionalidades desenvolvidas}
O processo de desenvolvimento de software, assim como o desenvolvimento de testes 
deste trabalho de conclusão de curso teve seu enfoque na rede colaborativa baseada 
no noosfero desenvolvida para a Universidade de Brasília (UnB), trata-se na rede 
chamada de Comunidade UnB, que se encontra em ambiente de testes, porém disponível 
para acesso externo, contando com aproximadamente 160 usuários ativos. A rede 
Comunidade UnB é uma instância do Noosfero instalada através de um pacote em um 
servidor do Centro de Difusão de Tecnologia e Conhecimetno (CDTC) da UnB.
%
O propósito da rede Comunidade UnB é tornar-se um ambiente de colaboração entre os 
alunos da Universidade de Brasília, tanto de graduação quanto de pós-graduação, 
possibilitando criação comunidades e blogs para discussões, ou a disponibilização 
de artigos, trabalhos de graduação e pós-graduação onde qualquer membro da universidade 
tenha acesso.
%
Para que este propósito seja cumprido, funcionalidades importantes do Comunidade 
UnB precisavam ser desenvolvidas. Ao decorrer deste trabalho de graduação, foram 
desenvolvidos, juntamente com seus respectivos testes, alguns plugins que serão 
descritos abaixo.
%------------------------------------------------------------------------------%
\subsection{Plugin Ldap UnB}
%
Como rede colaborativa dos membros da Universidade de Brasília, o Comunidade UnB 
necessita possuir restrição de acesso aos usuários, para que somente membros ativos 
da Universidade tenham acesso ao conteúdo da rede colaborativa. 
%
Para que esta necessidade fosse satisfeita foi desenvolvido um plugin no Noosfero, 
que efetuasse as restrições necessárias, utilizando o protocolo de autenticação da 
UnB, o LDAP.
%
\textit{Lightweight Directory Access Protocol} (LDAP) é um protocolo de aplicação 
aberto para acesso e manutenção  de serviços de informação de diretório distribuídos 
na internet~\cite{sermersheim2006}.
%
Os serviços de diretório desempenham um papel importante no desenvolvimento de aplicativos 
de intranet e Internet, permitindo o compartilhamento de informações sobre os usuários, 
sistemas, redes, serviços e aplicações em toda a rede~\cite{oracle2000}.
%
Um cliente inicia uma sessão de LDAP através da ligação a um servidor LDAP, chamado 
\textit{Directory System Agent} (DSA), por padrão, a porta TCP e UDP porta 389. Após 
a conexão,é requerida ao servidor uma operação do cliente, e o servidor responde a 
mesma. 
%
Abaixo, as operações que podem ser requeridas pelo cliente:
%
\begin{enumerate}
\item \textit{startTLS}: utilização da extensão TLS (\textit{Transport Layer Security}) 
para conexão segura;
\item \textit{bind}: autenticar e especificar versão do protocolo LDAP;
\item \textit{search}: busca de entradas de diretório
\item \textit{compare}: verificar atributos em uma entrada de diretório;
\item \textit{add}: adicionar uma nova entrada;
\item \textit{delete}: excluir uma entrada existente;
\item \textit{modify}: modificar  uma entrada existente;
\item \textit{modify distinguished name (DN}: mover ou renomear uma entrada existente;
\item \textit{abandon} : abortar uma requisição efetuada anteriormente;
\item \textit{extended operation}: operação genérica;
\item \textit{unbind} : finalizar conexão;
\end{enumerate}
%
Para o usuário, o plugin desenvolvido modifica a seção de cadastro de novos usuários 
e a seção de login de usuários. Na seção de cadastro o usuário agora deve cadastrar a 
matrícula e senha que o mesmo usa no matricula web da UnB, além dos dados que já eram 
cadastrados anteriormente. Na seção de login o usuário também pode entrar no Comunidade 
UnB através de sua matricula e senha do matricula web da UnB (além do email e username 
- entradas normalmente utilizadas)
%
Nas camadas mais inferiores, o plugin é responsável por modificar o modelo de dados do 
sistema, para que o usuário possa assim cadastrar sua matrícula. Assim o plugin também é responsável por configurar a conexão com o LDAP server da UnB e finalmente verificar se 
os dados do usuário estão corretos no momento do seu cadastro.
\subsubsection{Testes com plugin ldap}
%
Foram realizados os seguintes testes  com o plugin ldap unb: testes funcionais, testes 
unitários e testes de aceitação. Os testes funcionais e unitários foram executados através 
do próprio noosfero, já os testes de aceitação foram executados com auxílio das ferramentas Cucumber e Selenium.
%
\subsubsection{Testes Funcionais}
%
Os testes funcionais do plugin ldap foram divididos em duas categorias, sendo estas compostas por testes que não dependem do LDAP está configurado e os testes que dependem do LDAP configurado. Os testes independentes do LDAP são simples, basicamente verificando as possiveis mensagem de errro ou de notificações durante o login. Os testes  que dependem do ldap verificam os seguintes fatores:
%
\begin{enumerate}
\item Autenticação de usuario com ldap;
\item Autenticação de usuário a partir da sua matrícula;
\item Exibição de mensagens de logs
\item Criação de usuário utilizando as propriedades do ldap;
\item Não autenticação de usuário registadro localmente, mas não com ldap;
\item Não autenticação de usuário não registrado localmente, mas com ldap;
\item Criação e autenticação de um novo usuário a partir do plugin ldap;
\end{enumerate}
%
Também foram executados testes na interface de administrador do sistema, onde o usuário tem a opção de ativar o plugin e informar dados de configuração do mesmo, estes testes verificam os seguintes fatores:
%
\begin{enumerate}
\item Acesso à página de administrador;
\item Exibição de mensagens de sucesso e de erro;
\item Atualização do ldap;
\item Atualização do host do ldap;
\item Atualização da porta do ldap;
\item Atualização da conta do ldap;
\item Atualização da senha do ldap;
\item Atualização da base dn;
\item Atualização do atributo de login;
\item Atualização do atributo de email;
\item Atualização do filtro do ldap;
\item Atualização de TLS;
\end{enumerate}

% -------------PENSAR EM IMAGENS-----------------------%

\subsubsection{Testes unitários}
%
Os testes unitários do plugin verificam a definição dos parâmetros do ldap, verificação esta que é realizada tanto na passagem dos parâmentros quanto na verificação dos valores de default.

Com o auxilio de uma ferramenta de análise de código para Ruby chamada Rcov, foi obtida a taxa de cobertura de código do plugin desenvolvido, além de alguns dados sobre a execução dos testes que seguem abaixo:
\begin{enumerate}
\item Quantidade de testes executados: 96 testes
\item Quantidade de assertivas executadas: 111 assertivas
\item Quantiadde de falhas obtidas: 0 falhas
\item Tempo de execução dos testes: 7.8 segundos
\end{enumerate}
%
Na imagem abaixo existem dois graficos de cobertura de codigo, o primeiro definido como \textit{'total coverage'} representa a contagem realizada com as linhas em branco e os comentários do código, já o \textit{'code coverage'} representa a contagem realizada sem as linhas em branco e os comentários do código.
%
\begin{figure}[!h]
    \centering
    \includegraphics[keepaspectratio=false,scale=0.45]
      {figuras/cobertura_teste.eps}
    \caption{Cobertura de código do Plugin LdapUnb}
    \label{noosfero_bug}
\end{figure}
%

\subsubsection{Testes de aceitação}